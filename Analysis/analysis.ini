//データ分析機能の定義
テーブル：最大値＝「| f1 flag |
　フィールド番号=自分！(f1) フィールド番号取得。
　ret=テーブル！(フィールド名) 作る。
　「フィールド番号！=undef」！なら「
　　要素数＝フィールド名！要素数?。
　　max番号＝配列！作る。
　　「|i|
　　　val=(自分！(フィールド番号+(i-1)*要素数)　読む)。
　　　「i==1」！なら「max=val。」実行。
　　　「全部！(max<val) (val!="NA") 本当」！なら「
　　　　max=val。
　　　　max番号＝配列！(1+(i-1)*要素数) 作る。
　　　」そうでなければ「max==val」なら「
　　　　max番号！(1+(i-1)*要素数) 書く。
　　　」実行。
　　」！((自分！要素数?)/要素数) 繰り返す。
　　テーブル：_MAX=max。
　　max番号!「| i |
　　　「|j|
　　　　ret!(自分!(i+j-1)　読む)　書く。
　　　」！(要素数)繰り返す。
　　」それぞれ実行。
　」実行。
　「flag == "true"」！なら「
　　ret=テーブル！(最大値)　作る。
　　ret!(max)　書く
　　//自分：分析結果！(配列！"最大値" (max) 作る) 書く．
　」実行．
　ret。
」。

テーブル：最小値＝「| f1 flag |
　フィールド番号=自分！(f1) フィールド番号取得。
　ret=テーブル！(フィールド名) 作る。
　「フィールド番号！=undef」！なら「
　　要素数＝フィールド名！要素数?。
　　min番号＝配列！作る。
　　「|i|
　　　val=(自分！(フィールド番号+(i-1)*要素数)　読む)。
　　　「i==1」！なら「min=val。」実行。
　　　「全部！(min>val) (val!="NA") 本当」！なら「
　　　　min=val。
　　　　min番号＝配列！(1+(i-1)*要素数) 作る。
　　　」そうでなければ「min==val」なら「
　　　　min番号！(1+(i-1)*要素数) 書く。
　　　」実行。
　　」！((自分！要素数?)/要素数) 繰り返す。

　　テーブル：_MIN=min。
　　min番号!「| i |
　　　「|j|
　　　　ret!(自分!(i+j-1)　読む)　書く。
　　　」！(要素数)繰り返す。
　　」それぞれ実行。
　」実行。

　「flag == "true"」！なら「
　　ret=テーブル！(最小値)　作る。
　　ret!(min)　書く
　　//自分：分析結果！(配列！"最小値" (min) 作る) 書く．
　」実行．
　ret。
」。

テーブル：最頻値＝「| f1 |
　freq_arr=自分！(f1) 度数。
　max=freq_arr!"度数" 最大値 。
　mode=配列！作る。
　ret=テーブル！((f1)+"_最頻値") "度数" 作る。
　max！「| val cnt |
　　ret!(val) 書く。
　」それぞれ実行。
　ret。
」。

テーブル：合計値＝「| f1 flag |
　フィールド番号=自分！(f1) フィールド番号取得。
　ret=テーブル！((f1)+"_合計値") 作る。
　sum=0。
　「フィールド番号！=undef」！なら「
　　「|i|
　　　　「(自分！(フィールド番号+(i-1)*(フィールド名!要素数?)) 読む)!="NA"」!なら「
　　　　　sum=sum+(自分！(フィールド番号+(i-1)*(フィールド名!要素数?)) 読む)。
　　　　」実行。
　　」！((自分！要素数?)/要素数) 繰り返す。
   ret!(sum) 書く。
　」実行。
　「flag != "true"」！なら「
　　自分：分析結果！(配列！"合計値" (sum) 作る) 書く。
　」実行。
　ret。
」。

テーブル：平均値＝「| f1 flag |
　フィールド番号=自分！(f1) フィールド番号取得。
　ret=テーブル！((f1)+"_平均値") 作る。
　レコード数=(自分！要素数?)/(フィールド名!要素数?)。
　sum=0。
　「フィールド番号！=undef」！なら「
　　「|i|
　　　　「(自分！(フィールド番号+(i-1)*(フィールド名!要素数?)) 読む)=="NA"」！なら「
　　　　　レコード数=レコード数-1。
　　　　」そうでなければ「
　　　　　sum=sum+(自分！(フィールド番号+(i-1)*(フィールド名!要素数?)) 読む)。
　　　　」実行。
　　」！((自分！要素数?)/要素数) 繰り返す。
   ret!(sum/(レコード数)) 書く。
　」実行。

　「flag != "true"」！なら「
　　自分：分析結果！(配列！"平均値" (ave) 作る) 書く。
　」実行。
　ret。
」。

テーブル：偏差＝「| f1 |
　
　ave=自分！(f1) 平均値 値読み出し。
　f1_arr=自分！(f1) 射影。
　dev_arr=配列！作る。
　f1_arr！「｜n｜
　　「n!="NA"」!なら「
    　dev_arr!(n-ave) 書く。
    」実行。
  」それぞれ実行。
　ret=テーブル！((f1)+"_偏差") 作る。
　dev_arr！「| val |
　　ret!(val) 書く。
　」それぞれ実行。
　ret。
」。


テーブル：分散＝「| f1 flag |
　data_array＝自分！(f1) 射影。
　data_array!"NA" 消す。
　sum=自分！(f1) 合計値　値読み出し。
　ave=sum/(data_array!要素数?)。
　dev=0.
　data_array！「｜n｜
　　dev = dev + (((n)-(ave))*((n)-(ave)))。
　」それぞれ実行。
　disp=0.
　disp = dev/(data_array！要素数?)。
　//テーブル！作る。をして、その要素として値を書く必要がある
 「flag != "true"」！なら「
　　自分：分析結果！(配列！"分散" (disp) 作る) 書く。
　」実行。
　ret=テーブル！((f1)+"_分散") 作る。
　ret!(disp) 書く。
　ret。
」。

テーブル：共分散＝「|f1 f2|
　f1_dev_arr=自分！(f1) 偏差。　
　f2_dev_arr=自分！(f2) 偏差。
　total＝0。
　f1_dev_arr！「| val cnt |
　　total=total+(val*(f2_dev_arr! (cnt) 読む))。
　」それぞれ実行。

　cav=total/(f1_dev_arr!要素数?)。
　ret=テーブル！((f1)+"&"+(f2)+"_共分散") 作る。
　ret!(cav)　書く。
　ret。
」。

テーブル：相関係数＝「| f1 f2 |
　cav=自分！(f1) (f2) 共分散 値読み出し。
　st_dev1=自分！(f1) 標準偏差 値読み出し。
　st_dev2=自分！(f2) 標準偏差 値読み出し。
　cor=cav/(st_dev1*st_dev2)。
 ret=テーブル！((f1)+"&"+(f2)+"_相関係数") 作る。
 ret!(cor)　書く。
 ret。
」。


テーブル：標準偏差＝「| f1 flag |
　disp=自分！(f1) "true" 分散　値読み出し。
　sdev=sqrt(disp)。
	「flag != "true"」！なら「
	 自分：分析結果！(配列！"標準偏差" (sdev) 作る) 書く。
  」実行．
  ret=テーブル！((f1)+"_標準偏差") 作る。
　ret!(sdev) 書く。
」。

テーブル：中央値＝「| f1 flag |
　data_arr＝自分！(f1)　小さい順 (f1) 射影。
　data_arr=data_arr!"NA" 消す。
　要素数=data_arr!要素数?。
　ret=テーブル！((f1)+"_中央値") 作る。
　「要素数!=0」!なら「
　　中心=ceil(要素数/2)。
　　「(要素数%2)==0」!なら「
　　　　median=((data_arr！(中心)　読む)+(data_arr！(中心+1) 読む))/2。
　　　」そうでなければ「
　　　　median=data_arr！(中心) 読む。
　　　」実行。
　　「flag != "true"」！なら「
　　　　自分：分析結果！(配列！"中央値" (median) 作る) 書く。
　　　」実行。
　　ret!(median) 書く。
　」そうでなければ「
　　ret!(undef) 書く。
　」実行。
　ret。
」。

テーブル:第１四分位数＝「| f1 flag |
　data_arr＝自分！(f1)　小さい順 (f1) 射影。
　data_arr=data_arr!"NA" 消す。
　要素数=data_arr!要素数?。
　中心=floor(要素数/2)。
　data=テーブル!(f1) 作る。
　「|i|　data!(data_arr!(i) 読む) 書く」!(中心)　繰り返す。
  qua1 = data! (f1) "true" 中央値　値読み出し。

　「flag != "true"」！なら「
　　自分：分析結果！(配列！"第1四分位数" (qua1)　作る) 書く。
　」実行。
　ret=テーブル！((f1)+"_第1四分位数") 作る。
　ret!(qua1)　書く。
」．

テーブル:第3四分位数＝「| f1 flag |
　data_arr＝自分！(f1)　大きい順 (f1) 射影。
　data_arr=data_arr!"NA" 消す。
　要素数=data_arr!要素数?。
　中心=floor(要素数/2)。
　data=テーブル!(f1) 作る。
　「|i|　data!(data_arr!(i) 読む) 書く」!(中心)　繰り返す。
  qua3 = data! (f1) "true" 中央値　値読み出し。

　「flag != "true"」！なら「
　　自分：分析結果！(配列！"第3四分位数" (qua3)　作る) 書く。
　」実行。
　ret=テーブル！((f1)+"_第3四分位数") 作る。
　ret!(qua3)　書く。
」．

テーブル：度数＝「｜f1 階級幅　min max；文字コード配列にする 文字列にする　キー達　値達　ret｜
	キー達＝配列！作る。
	値達=配列！作る.
	f1の番号＝０．
  f1_arr=自分!(f1) 射影。
  f1_arr=f1_arr!"NA" 消す。
  階級=配列！作る。
　カウント=配列！作る。
　「階級幅 != undef」!なら「
　　「min==undef」！なら「min=f1_arr!最小。」実行。
　　「max==undef」！なら「max=f1_arr!最大。」実行。
　　sum=max-min.
　　階級数=round(sum/階級幅)。
　　「全部！(max < 1) (max > 0)　本当」！なら「
　　　digit=ceil(log(abs(max))).
　　」そうでなければ「
　　　digit=1。
　　」実行。
　　ret=テーブル！"階級" "度数"作る。
　　「| n |
　　　「n!=階級数」！なら「
　　　　階級!(配列! ((min+階級幅*(n-1))+("以上~"+(min+階級幅*n)+"未満")) 作る) 書く。
　　　」そうでなければ「
　　　　階級!(配列! ((min+階級幅*(n-1))+("以上~"+(min+階級幅*n))) 作る) 書く。
　　　」実行。
　　　(階級!(n) 読む)! 0 書く。
　　　「n==1」！なら「カウント!(min+階級幅*(n-1)) 書く。」そうでなければ「カウント!(min+階級幅*(n-1)) 書く。」実行。
　　」！(階級数) 繰り返す。

　　f1_arr!「| n i |
　　　カウント！「| m j |
　　　　「j==階級数」！なら「
　　　　　「全部！((m <= n)) ((m+階級幅) >= n) 本当」!なら「
　　　　　　(階級！(j) 読む)! 2  (((階級！(j) 読む)! 2 読む)+1) 上書き。
　　　　　」実行。　
　　　　」そうでなければ「
　　　　　「全部！((m <= n)) ((m+階級幅) > n) 本当」!なら「
　　　　　　(階級！(j) 読む)! 2  (((階級！(j) 読む)! 2 読む)+1) 上書き。
　　　　　」実行。
　　　　」実行。
　　　」それぞれ実行。
　　」それぞれ実行。
　　階級!「| n |
　　　n!「|val| ret!(val) 書く。」それぞれ実行。
　　」それぞれ実行。


　」そうでなければ「
　　フィールド名要素数＝自分：フィールド名！要素数？。

　　ret=テーブル！(f1) "度数" 作る。
　　文字コード配列にする＝「｜str;ret｜
　　　ret=配列！作る。
　　　(str+"")!""分割「｜要素｜
　　　　ret!(要素！文字コード)書く。
　  　」それぞれ実行。
　　ret。
　　」。
　　文字列にする＝「｜文字コード配列;ret｜
　　　ret=""。
　　　文字コード配列！「｜要素｜
　　　　ret＝（ret！（（要素）！コード文字）連結）。
　　　」それぞれ実行。
　　　ret。
　　」。

　　キー達：探す＝「｜キー；結果　文字コード配列の比較｜
　　　結果＝０。

　　　文字コード配列の比較＝「｜左　右｜
　　　　(""+左)==(""+右)
　　　」。

　　　「｜番号｜
  　　　「！（自分！（番号）読む）（キー）文字コード配列の比較」！なら「結果＝番号」実行。
　　　」！（自分！要素数？）繰り返す。
　　　結果。
　　」。
　　「｜番号｜
　　　「（フィールド名！（番号）読む）＝＝f1」！なら「
　  　　f1の番号＝番号。
　　　」実行。
　　」！（フィールド名要素数）繰り返す。


　「｜番号；値　キー番号｜
    「(自分！（フィールド名要素数*(番号-1)+f1の番号）読む)!="NA"」！なら「
      値＝!(自分！（フィールド名要素数*(番号-1)+f1の番号）読む)文字コード配列にする。
      「（キー達！（値）探す）＝＝０」！なら「キー達！（値）書く。値達！０　書く。」実行。
      キー番号＝キー達！（値）探す。
      値達！（キー番号）（（値達！（キー番号）読む）＋１）上書き。
    」実行。
　」！（（自分！要素数？）/（フィールド名要素数））繰り返す。


　//テキストエリア！（キー達）作る。
　　「｜番号｜
　　　ret!(！(キー達！（番号）読む)文字列にする）（値達！（番号）読む）書く。
　　」！（キー達！要素数？）繰り返す。
　」実行。
 ret。
」。


テーブル：度数分布表＝「| f1 階級幅　min max |
　「階級幅!=undef」!なら「
　　freq=自分！(f1) (階級幅) (min) (max) 度数。
　　sum=0.
　　階級配列=freq!"階級" 射影。
　　度数配列＝freq!"度数" 射影。
　　度数分布配列=配列！作る。
　　sum=freq!"度数" 合計値 値読み出し。
　　
　　度数配列！「|n|
　　　度数分布配列！(n/sum) 書く。
　　」それぞれ実行。

　　ret=テーブル！"階級" "度数" "相対度数" 作る。
　　「| i |
　　　ret！(階級配列！(i) 読む) 書く．
　　　ret！(度数配列！(i) 読む) 書く．
　　　ret！(度数分布配列！(i) 読む) 書く．
　　」！(階級配列！要素数?) 繰り返す。

　」そうでなければ「
　　freq=自分！(f1) 度数。
　　sum=freq!(f1) 合計値 値読み出し。
　　ret=テーブル！(f1) "度数" "相対度数" 作る。
　　freq！「| n i |
　　　ret!(n) 書く。
　　　「i%2==0」!なら「
　　　　ret!(n/sum) 書く。
　　　」実行。
　　」それぞれ実行．
　」実行。
　ret。
」。

テーブル：件数＝「|;ret|
　ret=テーブル!"件数" 作る。
　ret!((自分！要素数？)/(フィールド名!要素数?)) 書く。
　ret。
」。
